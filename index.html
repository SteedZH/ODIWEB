<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Map</title>
        <link rel="stylesheet" type="text/css" href="map.css">
        <script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
    </head>
    <!-- <style>
    .position circle{
        fill: rgb(0, 51, 0);
    }
    </style> -->
    <body>
        <script>
            var width = window.innerWidth;
            var height = window.innerHeight;

            var svg = d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", "translate(0,0)");
            
            var projection = d3.geoMercator()
                                .center([0,0])
                                .scale(300)
                                .translate([width/2, height/2]);
            
            var path = d3.geoPath()
                        .projection(projection);
            
            var color = d3.scaleOrdinal(d3.schemeCategory20);

            var tooltip = d3.select("body")
                    .append("div")
                    .attr("class", "tooltip")
                    .style("opacity", 0.0)  

            d3.json("worldmap.geojson", function(error, root){

                if(error)
                    return console.error(error);
                console.log(root.features);
                var world = svg.append("g");
                world.selectAll("path")
                    .data(root.features)
                    .enter()
                    .append("path")
                    // .attr("strole", "#000")
                    // .attr("stroke-width", 1)
                    .attr("fill", function(d,i){
				        return color(i);
                    })
                    .attr("d", path )
                    .on("mouseover",function(d,i){
                        d3.select(this)
                            .attr("fill","yellow");
                    })
                    .on("mouseout",function(d,i){
                        d3.select(this)
                            .attr("fill",color(i));
                    });
                
                    d3.csv("refine.csv", function(data) {
                    return {
                        country: data["country_long"],
                        capacity: +data["capacity_mw"],
                        latitude: +data["latitude"],
                        longitude: +data["longitude"],
                        position: [data["longitude"], data["latitude"]],
                        fuel: data["fuel1"]
                    };
                },

                function(error, data) {
                    if (error){
                        console.log("ERROR: ");
                        console.log(error);
                        return;
                    }
                console.log(data);
                var position = svg.selectAll(".position")
                    .data(data)
                    .enter()
                    .append("g")
                    .attr("class", "position")
                    .append("circle").attr("r",3)
                    .attr("transform",function(d){
                        var coordinates = projection([d.longitude, d.latitude]);
                        return "translate("+ coordinates[0] + "," + coordinates[1] +")"
                    })
                    .on("mouseover", function(d){
                                d3.select(this)
                                    .classed("active", true);
                                console.log("just had a mouseover", d, d3.select(d));
                                tooltip.html(d.country_long+"<br/>"+"Capacity: "+d.capacity_mw+"<br/>"+"fuel: "+d.fuel1+"<br/>"+"Longitude: "+d.longitude+"<br/>"+"latitude " +d.latitude+"<br/>")
                                    .style("left",(d3.event.pageX) + "px")
                                    .style("top",(d3.event.pageY+20) + "px")
                                    .style("opacity",0.5)
                        })
                    .on("mousemove", function(d){
                            tooltip.style("left", (d3.event.pageX)+"px")
                                   .style("top", (d3.event.pageY+20)+"px")
                        })
                    .on("mouseout", function(d){
                                tooltip.style("opacity", 0.0)
                                d3.select(this)
                                    .classed("active", false)
                        });
                    
                // position.append("circle")
                //     .attr("r",3);     
                }
            );
            });
        </script>
    </body>
</html>
