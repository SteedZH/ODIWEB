<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Map</title>
        <script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
    </head>
    <style>
    .position circle{
        fill: blue;
    }
    </style>
    <body>
        <script>
            var width = window.innerWidth;
            var height = window.innerHeight;

            var svg = d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", "translate(0,0)");

            var projection = d3.geoMercator()
                                .center([0,0])
                                .scale(300)
                                .translate([width/2, height/2]);
            
            var path = d3.geoPath()
                        .projection(projection);
            
            var color = d3.scaleOrdinal(d3.schemeCategory20);

            d3.json("worldmap.geojson", function(error, root){

                if(error)
                    return console.error(error);
                console.log(root.features);
                var world = svg.append("g");
                world.selectAll("path")
                    .data(root.features)
                    .enter()
                    .append("path")
                    // .attr("strole", "#000")
                    // .attr("stroke-width", 1)
                    .attr("fill", function(d,i){
				        return color(i);
                    })
                    .attr("d", path )
                    .on("mouseover",function(d,i){
                        d3.select(this)
                            .attr("fill","yellow");
                    })
                    .on("mouseout",function(d,i){
                        d3.select(this)
                            .attr("fill",color(i));
                    });
                
                    d3.csv("refine.csv", function(data) {
                    return {
                        country: data["country_long"],
                        capacity: +data["capacity_mw"],
                        latitude: +data["latitude"],
                        longitude: +data["longitude"],
                        position: [data["longitude"], data["latitude"]],
                        fuel: data["fuel1"]
                    };
                },

                function(error, data) {
                    if (error){
                        console.log("ERROR: ");
                        console.log(error);
                        return;
                    }
                var position = svg.selectAll(".position")
                    .data(data)
                    .enter()
                    .append("g")
                    .attr("class", "position")
                    .attr("transform",function(d){
                        var coordinates = projection([d.longitude, d.latitude]);
                        return "translate("+ coordinates[0] + "," + coordinates[1] +")";
                    });
                position.append("circle")
			        .attr("r",2);
                }
            );
            });
            
            

        </script>
    </body>
</html>
